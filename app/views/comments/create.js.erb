var $form = $("#new_comment");
var newCommentSaved = "<%= @saved %>" === "true";
var $input = $form.find("#comment_body");
var $comments = $(".comments");

resetForms();
newCommentSaved ? renderSuccess() : renderErrors();

function resetForms() {
  var $invalidInputs = $form.find(".is-invalid");
  var $helpTexts = $form.find(".invalid-feedback");

  $invalidInputs.removeClass("is-invalid");
  $helpTexts.remove();
}

function resetInput($input) {
  return $input.val("");
}

function renderSuccess() {
  var comment = "<%= j render(partial: 'comments/comment', locals: { comment: @comment }) %>";
  var commentID = "<%= @comment.id %>";
  var $commentContainer = $comments.find(`[data-comment-id='${commentID}']`);

  $comments.prepend(comment);
  $commentContainer.hide().fadeIn("slow");
  resetInput($input);
}

function renderErrors() {
  var errors = "<%= @errors %>";
  var $helpDanger = $('<div/>', { "class": "invalid-feedback" });

  $input.addClass("is-invalid");
  $helpDanger.text("Uh-oh: " + errors);
  $helpDanger.insertAfter($input);
  $helpDanger.hide().fadeIn("slow");
}
